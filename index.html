<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ESNILOMA | Tienda Premium</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --azul-premium: #0f172a;
            --verde-confirmar: #22c55e;
            --fondo-app: #f8fafc;
            --tarjeta: #ffffff;
            --texto-principal: #1e293b;
            --texto-secundario: #64748b;
            --accent: #3b82f6;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family:'Outfit', sans-serif; -webkit-tap-highlight-color:transparent; }
        body { background: var(--fondo-app); color: var(--texto-principal); padding-bottom: 100px; }

        header { background: var(--tarjeta); padding: 20px; border-bottom: 1px solid #e2e8f0; position: sticky; top:0; z-index:100; }
        .saludo h1 { font-size: 24px; font-weight: 800; }
        .saludo p { color: var(--texto-secundario); font-size: 14px; }

        .search-container { margin: 15px 0; position: relative; }
        .search-container input { width:100%; padding:12px 40px; border-radius:15px; border:1px solid #e2e8f0; background:#f1f5f9; outline:none; }
        .search-container ion-icon { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--texto-secundario); font-size:20px; }

        .categories { display:flex; gap:10px; overflow-x:auto; padding:5px 0; scrollbar-width:none; }
        .cat-item { padding:8px 20px; background:white; border-radius:12px; font-size:14px; white-space:nowrap; border:1px solid #e2e8f0; cursor:pointer; }
        .cat-item.active { background:var(--azul-premium); color:white; border-color:var(--azul-premium); }

        .grid-productos { display:grid; grid-template-columns: repeat(2, 1fr); gap:15px; padding:20px; }
        .card { background:white; border-radius:20px; padding:12px; position:relative; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05); }
        .card img { width:100%; height:140px; object-fit:cover; border-radius:15px; margin-bottom:10px; }
        .card h3 { font-size:14px; font-weight:600; margin-bottom:5px; }
        .card .price { color:var(--azul-premium); font-weight:800; font-size:16px; }
        .add-btn { position:absolute; bottom:12px; right:12px; background:var(--azul-premium); color:white; border:none; width:32px; height:32px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; }

        #cart-count { position:fixed; bottom:30px; right:30px; background:var(--verde-confirmar); color:white; padding:15px 25px; border-radius:30px; font-weight:800; box-shadow:0 10px 15px -3px rgba(34,197,94,0.4); z-index:1000; display:none; border:none; cursor:pointer; }

        /* Estilos del Carrito */
        #modal-carrito { position:fixed; bottom:-100%; left:0; width:100%; height:85%; background:white; z-index:2000; border-top-radius:30px; border-top-left-radius:30px; border-top-right-radius:30px; padding:25px; transition:0.4s; box-shadow:0 -10px 25px rgba(0,0,0,0.1); }
        #overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1500; display:none; }
    </style>
</head>
<body>

    <header>
        <div class="saludo">
            <h1 id="saludo-titulo">Â¡Hola! ðŸ‘‹</h1>
            <p id="sub-saludo">Bienvenido a ESNILOMA.</p>
        </div>
        
        <div class="search-container">
            <ion-icon name="search-outline"></ion-icon>
            <input type="text" id="inputBusqueda" placeholder="Busca productos..." oninput="ejecutarFiltros()">
        </div>

        <div class="categories">
            <div class="cat-item active" onclick="seleccionarCategoria('todos', this)">Todos</div>
            <div class="cat-item" onclick="seleccionarCategoria('calzado', this)">Calzado</div>
            <div class="cat-item" onclick="seleccionarCategoria('lacteos', this)">LÃ¡cteos</div>
            <div class="cat-item" onclick="seleccionarCategoria('aseo', this)">Aseo</div>
            <div class="cat-item" onclick="seleccionarCategoria('accesorios', this)">Accesorios</div>
        </div>
    </header>

    <div class="grid-productos" id="grid-productos">
        </div>

    <button id="cart-count" onclick="abrirCarrito()">
        ðŸ›’ Carrito
    </button>

    <div id="overlay" onclick="cerrarCarrito()"></div>

    <div id="modal-carrito">
        <h2 style="margin-bottom:20px;">Tu Pedido</h2>
        <div style="margin-bottom:20px;">
            <input type="text" id="nombre-cliente" placeholder="Tu Nombre" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;">
            <input type="text" id="direccion-cliente" placeholder="DirecciÃ³n de entrega" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;">
        </div>
        <div id="lista-items" style="max-height:300px; overflow-y:auto; margin-bottom:20px;"></div>
        <div style="display:flex; justify-content:space-between; font-weight:800; font-size:20px; margin-bottom:20px;">
            <span>Total:</span>
            <span id="total-monto">$0</span>
        </div>
        <button onclick="enviarWhatsApp()" style="width:100%; padding:15px; background:var(--verde-confirmar); color:white; border:none; border-radius:15px; font-weight:800; font-size:16px;">
            Pedir por WhatsApp
        </button>
    </div>

    <script>
        let productos = []; 
        let carrito = JSON.parse(localStorage.getItem('esniloma_cart')) || [];
        let categoriaActual = 'todos';

        async function cargarTienda() {
            try {
                const res = await fetch('./productos.json');
                productos = await res.json();
                renderizar(productos);
            } catch (e) {
                console.error("Error cargando productos", e);
            }
        }

        window.onload = cargarTienda;

        function renderizar(lista) {
            const grid = document.getElementById('grid-productos');
            grid.innerHTML = lista.map(p => `
                <div class="card">
                    <img src="${p.img}" onerror="this.src='https://via.placeholder.com/150'">
                    <h3>${p.nombre}</h3>
                    <p class="price">$${Number(p.precio).toLocaleString()}</p>
                    <button class="add-btn" onclick="agregar('${p.nombre}')"><ion-icon name="add"></ion-icon></button>
                </div>
            `).join('');
            actualizarContador();
        }

        function agregar(nombre) {
            const p = productos.find(x => x.nombre === nombre);
            const item = carrito.find(x => x.nombre === nombre);
            if(item) item.cantidad++; else carrito.push({...p, cantidad: 1});
            actualizarContador();
            localStorage.setItem('esniloma_cart', JSON.stringify(carrito));
        }

        function actualizarContador() {
            const total = carrito.reduce((acc, i) => acc + i.cantidad, 0);
            const btn = document.getElementById('cart-count');
            btn.style.display = total > 0 ? 'block' : 'none';
            btn.innerText = `ðŸ›’ ${total} Productos`;
        }

        function abrirCarrito() {
            document.getElementById('modal-carrito').style.bottom = '0';
            document.getElementById('overlay').style.display = 'block';
            const lista = document.getElementById('lista-items');
            let total = 0;
            lista.innerHTML = carrito.map((item, i) => {
                total += (Number(item.precio) * item.cantidad);
                return `<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>${item.cantidad}x ${item.nombre}</span>
                    <span>$${(item.precio * item.cantidad).toLocaleString()}</span>
                </div>`;
            }).join('');
            document.getElementById('total-monto').innerText = `$${total.toLocaleString()}`;
        }

        function cerrarCarrito() {
            document.getElementById('modal-carrito').style.bottom = '-100%';
            document.getElementById('overlay').style.display = 'none';
        }

        function enviarWhatsApp() {
            const nombre = document.getElementById('nombre-cliente').value;
            const dir = document.getElementById('direccion-cliente').value;
            if(!nombre || carrito.length === 0) return alert("Llena tus datos");

            let texto = `*NUEVO PEDIDO ESNILOMA*%0ACliente: ${nombre}%0ADirecciÃ³n: ${dir}%0A%0A`;
            carrito.forEach(i => texto += `- ${i.cantidad}x ${i.nombre}%0A`);
            window.open(`https://wa.me/18097600364?text=${texto}`);
        }

        function seleccionarCategoria(cat, el) {
            document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            categoriaActual = cat;
            ejecutarFiltros();
        }

        function ejecutarFiltros() {
            const busqueda = document.getElementById('inputBusqueda').value.toLowerCase();
            const f = productos.filter(p => {
                const matchCat = categoriaActual === 'todos' || p.categoria.toLowerCase() === categoriaActual;
                const matchNombre = p.nombre.toLowerCase().includes(busqueda);
                return matchCat && matchNombre;
            });
            renderizar(f);
        }
    </script>
</body>
</html>






